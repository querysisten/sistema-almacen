<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Consulta Piezas Entregadas</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

  <!-- Librer√≠as para exportar Excel y PDF -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

  <link rel="stylesheet" href="{{ url_for('static', filename='css/marcas.css' ) }}">

  <style>
    /* Fondo gris para el contenedor del formulario */
    .container-fluid {
      background-color: #a09999;  /* Gris claro */
      padding: 20px;
      border-radius: 8px;
    }

    mark {
      background-color: #ffeb3b;
      color: black;
      padding: 0 2px;
      border-radius: 2px;
    }

    .input-group-text {
      background-color: #007bff;
      color: white;
    }

    .btn-success, .btn-danger {
      font-size: 14px;
    }

    .table {
      background-color: white; /* Mantener la tabla en blanco */
    }
  </style>
</head>
<body>
<div class="container-fluid p-3">
  <h1 class="text-center mb-4">Consulta Piezas Entregadas</h1>

   <!-- Buscador -->
  <div class="input-group justify-content-center my-4" style="max-width: 600px; margin: auto;">
    <span class="input-group-text d-flex align-items-center justify-content-center" style="height: 50px;">
      <i class="bi bi-search"></i>
    </span>
    <input type="text" id="buscador" class="form-control" placeholder="Buscar veh√≠culo" style="height: 50px;" autofocus>
  </div>

  <!-- Botones Exportar -->
  <div class="d-flex justify-content-center mb-4" style="gap: 10px;">
  <button class="btn btn-success" id="exportExcel">
    <i class="bi bi-file-earmark-spreadsheet"></i> Exportar Excel
  </button>
  <button class="btn btn-danger" id="exportPDF">
    <i class="bi bi-file-earmark-pdf"></i> Exportar PDF
  </button>
</div>

  <!-- Tabla de piezas entregadas -->
  <div class="table-responsive">
    <table class="table table-striped table-hover table-sm" id="tb_entregas">
       <thead class="table-dark text-start align-middle">
        <tr>
          <th class="text-start">ID</th>
          <th class="text-start">Nom. Cliente</th>
          <th class="text-start">Ape. Cliente</th>
          <th class="text-start">T√©cnico</th>
          <th class="text-start">#Orden</th>
          <th class="text-start">Marca</th>
          <th class="text-start">Modelo</th>
          <th class="text-start">Pieza entregada</th>
          <th class="text-start">Cantidad</th>
          <th class="text-start">Observaci√≥n</th>
          <th class="text-start">Fecha</th>
        </tr>
      </thead>
      <tbody>
        {% for d in dato %}
        <tr>
          <td class="text-start">{{ loop.index }}</td>
          <td class="text-start">{{ d.nombre }} {{ d.cliente_nombre }}</td>
          <td class="text-start">{{ d.nombre }} {{ d.cliente_apellido }}</td>
          <td class="text-start">{{ d.empleado_nombre }}</td> 
          <td class="text-start">{{ d.orden }} </td>
          <td class="text-start">{{ d.marca }} {{ d.vehiculo_marca }}</td>
          <td class="text-start">{{ d.modelo}} {{ d.vehiculo_modelo}}</td>
          <td class="text-start">{{ d.descripcion}} {{ d.inventario_descripcion}}</td>
          <td class="text-start">{{ d.cantidad }} </td>
          <td class="text-start">{{ d.observacion }} </td>
         <td class="text-start"> {{ d.fecha }}</td></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
// üîç Buscador en tiempo real en toda la tabla
const buscador = document.getElementById('buscador');
const tbody = document.querySelector('#tb_entregas tbody');

buscador.addEventListener('input', () => {
  const query = buscador.value.toLowerCase().trim();

  tbody.querySelectorAll('tr').forEach(tr => {
    let coincide = false;

    // Limpiamos resaltado previo
    tr.querySelectorAll('td').forEach(td => td.innerHTML = td.textContent);

    // Buscar en todas las columnas
    tr.querySelectorAll('td').forEach(td => {
      const texto = td.textContent.toLowerCase();
      if (query && texto.includes(query)) {
        coincide = true;
        const regex = new RegExp(`(${query})`, 'gi');
        td.innerHTML = td.textContent.replace(regex, '<mark>$1</mark>');
      }
    });

    // Mostrar u ocultar fila
    tr.style.display = (query === '' || coincide) ? '' : 'none';
  });
});

// üìä Exportar Excel
document.getElementById('exportExcel').addEventListener('click', () => {
  const table = document.getElementById('tb_entregas');
  const wb = XLSX.utils.table_to_book(table, {sheet:"Piezas Entregadas"});
  XLSX.writeFile(wb, "Piezas_Entregadas.xlsx");
});

// üßæ Exportar PDF
document.getElementById('exportPDF').addEventListener('click', () => {
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();
  doc.text("Piezas Entregadas", 14, 20);
  doc.autoTable({
    startY: 25,
    html: '#tb_entregas',
    styles: { fontSize: 8 },
    headStyles: { fillColor: [0, 53, 128] }
  });
  doc.save("Piezas_Entregadas.pdf");
});
</script>
</body>
</html>